<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f8f9fa">
    <title>幼兒照護追蹤系統</title>
    <style>
        :root {
            --primary: #4F9EB5;
            --primary-light: #E5F1F5;
            --secondary: #F9C6D0;
            --secondary-light: #FFEFF2;
            --success: #AAD196;
            --warning: #FFCE7A;
            --danger: #FF8888;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }

        [data-theme="dark"] {
            --primary: #6CAFC4;
            --primary-light: #263A40;
            --secondary: #F9C6D0;
            --secondary-light: #40292D;
            --gray-100: #212529;
            --gray-200: #343a40;
            --gray-300: #495057;
            --gray-400: #6c757d;
            --gray-500: #adb5bd;
            --gray-600: #ced4da;
            --gray-700: #dee2e6;
            --gray-800: #e9ecef;
            --gray-900: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--gray-100);
            color: var(--gray-900);
            line-height: 1.5;
            min-height: 100vh;
            padding-bottom: 56px;
            transition: background-color 0.3s, color 0.3s;
        }

        header {
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 0.75rem 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.3s;
        }

        [data-theme="dark"] header {
            background-color: var(--gray-200);
        }

        .container {
            padding: 1rem;
            max-width: 540px;
            margin: 0 auto;
        }

        .hidden {
            display: none !important;
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .card {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 1rem;
            padding: 1rem;
            transition: background-color 0.3s;
        }

        [data-theme="dark"] .card {
            background-color: var(--gray-200);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--gray-800);
        }

        [data-theme="dark"] .card-title {
            color: var(--gray-700);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .child-selector {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .child-avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: 600;
            overflow: hidden;
        }

        .child-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .child-avatar.active {
            border: 2px solid var(--primary);
        }

        .tab-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #fff;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
            z-index: 100;
            transition: background-color 0.3s;
        }

        [data-theme="dark"] .tab-navigation {
            background-color: var(--gray-200);
        }

        .tab-navigation a {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            color: var(--gray-600);
            text-decoration: none;
            font-size: 0.75rem;
            width: 20%;
            text-align: center;
        }

        .tab-navigation a.active {
            color: var(--primary);
        }

        .tab-navigation i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            border: none;
            color: #fff;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        .btn-circle {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            color: var(--gray-700);
        }

        .btn-icon:hover {
            background-color: var(--gray-200);
        }

        .btn-primary {
            background-color: var(--primary);
        }

        .btn-primary:hover {
            background-color: #3e8ea6;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--gray-300);
            color: var(--gray-700);
        }

        .btn-outline:hover {
            background-color: var(--gray-200);
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #97bd83;
        }

        .btn-warning {
            background-color: var(--warning);
        }

        .btn-warning:hover {
            background-color: #ffc261;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #ff7070;
        }

        .fab {
            position: fixed;
            bottom: 4.5rem;
            right: 1rem;
            z-index: 90;
        }

        .quick-actions {
            position: absolute;
            bottom: 100%;
            right: 0;
            margin-bottom: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            transition: transform 0.3s, opacity 0.3s;
            transform: translateY(10px);
            opacity: 0;
            pointer-events: none;
        }

        .quick-actions.active {
            transform: translateY(0);
            opacity: 1;
            pointer-events: all;
        }

        .quick-actions .btn-circle {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .quick-action-label {
            position: absolute;
            right: 100%;
            margin-right: 0.5rem;
            white-space: nowrap;
            background-color: var(--gray-800);
            color: #fff;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        .form-control {
            display: block;
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: var(--gray-900);
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        [data-theme="dark"] .form-control {
            background-color: var(--gray-300);
            color: var(--gray-700);
            border-color: var(--gray-400);
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(79, 158, 181, 0.25);
        }

        .form-select {
            display: block;
            width: 100%;
            padding: 0.5rem 2rem 0.5rem 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: var(--gray-900);
            background-color: #fff;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 16px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            appearance: none;
        }

        [data-theme="dark"] .form-select {
            background-color: var(--gray-300);
            color: var(--gray-700);
            border-color: var(--gray-400);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23dee2e6' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
        }

        .form-select:focus {
            border-color: var(--primary);
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(79, 158, 181, 0.25);
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
        }

        .btn-group-toggle {
            display: flex;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--gray-300);
        }

        .btn-group-toggle label {
            flex: 1;
            padding: 0.5rem;
            text-align: center;
            background-color: #fff;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }

        [data-theme="dark"] .btn-group-toggle label {
            background-color: var(--gray-300);
            color: var(--gray-700);
        }

        .btn-group-toggle input[type="radio"] {
            position: absolute;
            clip: rect(0, 0, 0, 0);
            pointer-events: none;
        }

        .btn-group-toggle input[type="radio"]:checked + label {
            background-color: var(--primary);
            color: #fff;
        }

        /* Dashboard Styles */
        .stat-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-card {
            background-color: #fff;
            border-radius: 12px;
            padding: 0.75rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .stat-card {
            background-color: var(--gray-200);
        }

        .stat-card-title {
            font-size: 0.8rem;
            color: var(--gray-600);
            margin-bottom: 0.25rem;
        }

        .stat-card-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        [data-theme="dark"] .stat-card-value {
            color: var(--gray-700);
        }

        .timeline {
            margin-top: 1rem;
        }

        .timeline-item {
            display: flex;
            margin-bottom: 1rem;
        }

        .timeline-icon {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background-color: var(--primary-light);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-right: 0.75rem;
        }

        .timeline-icon.feeding {
            background-color: var(--secondary-light);
            color: var(--secondary);
        }

        .timeline-icon.sleep {
            background-color: #E5EDF9;
            color: #689CF8;
        }

        .timeline-icon.diaper {
            background-color: #F9F5E5;
            color: #D6C069;
        }

        .timeline-icon.health {
            background-color: #E9F9E5;
            color: #78C065;
        }

        .timeline-icon.milestone {
            background-color: #F9E5F6;
            color: #C069B9;
        }

        .timeline-content {
            flex: 1;
            background-color: #fff;
            border-radius: 8px;
            padding: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .timeline-content {
            background-color: var(--gray-200);
        }

        .timeline-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .timeline-text {
            font-size: 0.85rem;
            color: var(--gray-700);
        }

        .timeline-time {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        /* Care Module Styles */
        .feeding-type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .feeding-type {
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            padding: 0.5rem;
            text-align: center;
            cursor: pointer;
        }

        .feeding-type.active {
            background-color: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary);
        }

        .feeding-options-container {
            margin-top: 1rem;
        }

        .feeding-options {
            display: none;
        }

        .feeding-options.active {
            display: block;
        }

        .timer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .timer-display {
            font-size: 2rem;
            font-weight: 600;
            color: var(--gray-800);
            font-variant-numeric: tabular-nums;
        }

        [data-theme="dark"] .timer-display {
            color: var(--gray-700);
        }

        .timer-controls {
            display: flex;
            gap: 0.5rem;
        }

        .sleep-quality-selector {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .sleep-quality-option {
            text-align: center;
            cursor: pointer;
        }

        .sleep-quality-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
            color: var(--gray-400);
        }

        .sleep-quality-option.active .sleep-quality-icon {
            color: var(--primary);
        }

        .sleep-quality-label {
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .diaper-type-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .diaper-characteristics {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .characteristic-chip {
            background-color: var(--gray-200);
            border-radius: 16px;
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
            color: var(--gray-700);
            cursor: pointer;
        }

        .characteristic-chip.active {
            background-color: var(--primary-light);
            color: var(--primary);
        }

        /* Development Module Styles */
        .milestone-category {
            margin-bottom: 1.5rem;
        }

        .milestone-category-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--gray-800);
        }

        [data-theme="dark"] .milestone-category-title {
            color: var(--gray-700);
        }

        .milestone-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .milestone-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 8px;
            background-color: var(--gray-100);
        }

        [data-theme="dark"] .milestone-item {
            background-color: var(--gray-300);
        }

        .milestone-checkbox {
            margin-right: 0.75rem;
        }

        .milestone-text {
            font-size: 0.9rem;
            color: var(--gray-800);
        }

        [data-theme="dark"] .milestone-text {
            color: var(--gray-700);
        }

        .milestone-age {
            margin-left: auto;
            font-size: 0.75rem;
            color: var(--gray-600);
            background-color: var(--gray-200);
            padding: 0.1rem 0.5rem;
            border-radius: 4px;
        }

        [data-theme="dark"] .milestone-age {
            background-color: var(--gray-400);
            color: var(--gray-200);
        }

        .activity-type-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .activity-type {
            background-color: var(--gray-200);
            border-radius: 16px;
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
            color: var(--gray-700);
            cursor: pointer;
        }

        .activity-type.active {
            background-color: var(--primary-light);
            color: var(--primary);
        }

        .emotion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .emotion-tag {
            border-radius: 16px;
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .emotion-tag i {
            font-size: 1rem;
        }

        .happy {
            background-color: #FFEDD5;
            color: #F59E0B;
        }

        .calm {
            background-color: #E0F2FE;
            color: #0EA5E9;
        }

        .tired {
            background-color: #E0E7FF;
            color: #6366F1;
        }

        .fussy {
            background-color: #FEE2E2;
            color: #EF4444;
        }

        .curious {
            background-color: #D1FAE5;
            color: #10B981;
        }

        .photo-preview {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .preview-item {
            width: calc(33.333% - 0.35rem);
            aspect-ratio: 1/1;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-delete {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background-color: rgba(0, 0, 0, 0.5);
            color: #fff;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        /* Health Module Styles */
        .health-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .health-stat-label {
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        .health-stat-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        [data-theme="dark"] .health-stat-value {
            color: var(--gray-700);
        }

        .health-chart-container {
            margin-top: 1rem;
            height: 200px;
        }

        .vaccine-list {
            margin-top: 1rem;
        }

        .vaccine-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 8px;
            background-color: var(--gray-100);
            margin-bottom: 0.5rem;
        }

        [data-theme="dark"] .vaccine-item {
            background-color: var(--gray-300);
        }

        .vaccine-status {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            margin-right: 0.75rem;
        }

        .completed {
            background-color: var(--success);
        }

        .upcoming {
            background-color: var(--warning);
        }

        .overdue {
            background-color: var(--danger);
        }

        .vaccine-details {
            flex: 1;
        }

        .vaccine-name {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: var(--gray-800);
        }

        [data-theme="dark"] .vaccine-name {
            color: var(--gray-700);
        }

        .vaccine-schedule {
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        .vaccine-date {
            font-size: 0.8rem;
            color: var(--gray-600);
        }

        /* Settings Module Styles */
        .theme-switch {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 3.5rem;
            height: 2rem;
            margin-left: auto;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-300);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 1.5rem;
            width: 1.5rem;
            left: 0.25rem;
            bottom: 0.25rem;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:focus + .slider {
            box-shadow: 0 0 1px var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(1.5rem);
        }

        .setting-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .setting-label {
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        .setting-action {
            margin-left: auto;
        }

        .profile-form {
            margin-top: 1rem;
        }

        .avatar-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1rem;
        }

        .avatar-preview {
            width: 5rem;
            height: 5rem;
            border-radius: 50%;
            background-color: var(--gray-200);
            margin-bottom: 0.5rem;
            overflow: hidden;
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: calc(100% - 2rem);
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        [data-theme="dark"] .modal-content {
            background-color: var(--gray-200);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        [data-theme="dark"] .modal-title {
            color: var(--gray-700);
        }

        .modal-close {
            background: transparent;
            border: none;
            color: var(--gray-600);
            cursor: pointer;
            font-size: 1.25rem;
        }

        .modal-body {
            padding: 1rem;
        }

        .modal-footer {
            padding: 1rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        /* Utils */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mt-1 {
            margin-top: 0.25rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .mt-3 {
            margin-top: 1rem;
        }

        .mb-1 {
            margin-bottom: 0.25rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-3 {
            margin-bottom: 1rem;
        }

        .text-primary {
            color: var(--primary);
        }

        .text-success {
            color: var(--success);
        }

        .text-warning {
            color: var(--warning);
        }

        .text-danger {
            color: var(--danger);
        }

        .text-small {
            font-size: 0.85rem;
        }

        .text-gray {
            color: var(--gray-600);
        }

        /* Add support for virtual scrolling */
        .virtual-scroll-container {
            overflow-y: auto;
            height: calc(100vh - 200px);
            position: relative;
        }

        .virtual-scroll-content {
            position: absolute;
            width: 100%;
        }

        /* Make page transitions smoother */
        .page {
            animation: fadeIn 0.2s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 720px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="child-selector">
            <div class="child-avatar active" data-child-id="1">
                <img src="/api/placeholder/80/80" alt="孩子頭像">
            </div>
            <div>
                <div id="activeChildName">小明</div>
                <div class="text-small text-gray" id="activeChildAge">1歲3個月</div>
            </div>
        </div>
        <button class="btn-icon" id="childSwitchBtn">
            <i class="fas fa-ellipsis-v"></i>
        </button>
    </header>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page container">
        <div class="stat-cards">
            <div class="stat-card">
                <div class="stat-card-title">今日餵食</div>
                <div class="stat-card-value">5 次</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-title">睡眠時間</div>
                <div class="stat-card-value">4.5 小時</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-title">今日尿布</div>
                <div class="stat-card-value">6 次</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-title">上次體重</div>
                <div class="stat-card-value">9.2 公斤</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">今日活動</div>
            </div>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-icon feeding">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">餵食</div>
                        <div class="timeline-text">配方奶 150ml</div>
                        <div class="timeline-time">10:30</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon sleep">
                        <i class="fas fa-moon"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">睡眠</div>
                        <div class="timeline-text">2 小時 - 良好</div>
                        <div class="timeline-time">08:15 - 10:15</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon diaper">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">尿布更換</div>
                        <div class="timeline-text">濕尿布</div>
                        <div class="timeline-time">08:00</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon feeding">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">餵食</div>
                        <div class="timeline-text">母乳 (右側)</div>
                        <div class="timeline-time">07:30</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon health">
                        <i class="fas fa-medkit"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">健康紀錄</div>
                        <div class="timeline-text">體溫 37.0°C</div>
                        <div class="timeline-time">07:15</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Care Page -->
    <div id="carePage" class="page container hidden">
        <div class="card">
            <div class="card-header">
                <div class="card-title">餵食紀錄</div>
                <button class="btn btn-sm btn-primary" id="addFeedingBtn">
                    <i class="fas fa-plus"></i> 新增
                </button>
            </div>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-icon feeding">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">餵食</div>
                        <div class="timeline-text">配方奶 150ml</div>
                        <div class="timeline-time">10:30</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon feeding">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">餵食</div>
                        <div class="timeline-text">母乳 (右側)</div>
                        <div class="timeline-time">07:30</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon feeding">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">餵食</div>
                        <div class="timeline-text">副食品 米糊</div>
                        <div class="timeline-time">昨天 19:00</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">睡眠紀錄</div>
                <button class="btn btn-sm btn-primary" id="addSleepBtn">
                    <i class="fas fa-plus"></i> 新增
                </button>
            </div>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-icon sleep">
                        <i class="fas fa-moon"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">睡眠</div>
                        <div class="timeline-text">2 小時 - 良好</div>
                        <div class="timeline-time">08:15 - 10:15</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon sleep">
                        <i class="fas fa-moon"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">睡眠</div>
                        <div class="timeline-text">7 小時 - 普通</div>
                        <div class="timeline-time">昨天 22:00 - 今天 05:00</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">尿布紀錄</div>
                <button class="btn btn-sm btn-primary" id="addDiaperBtn">
                    <i class="fas fa-plus"></i> 新增
                </button>
            </div>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-icon diaper">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">尿布更換</div>
                        <div class="timeline-text">濕尿布</div>
                        <div class="timeline-time">08:00</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon diaper">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">尿布更換</div>
                        <div class="timeline-text">大便 - 黃色, 軟便</div>
                        <div class="timeline-time">昨天 21:30</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Development Page -->
    <div id="developmentPage" class="page container hidden">
        <div class="card">
            <div class="card-header">
                <div class="card-title">發展里程碑</div>
            </div>
            <div class="milestone-category">
                <div class="milestone-category-title">動作發展</div>
                <div class="milestone-list">
                    <div class="milestone-item">
                        <input type="checkbox" class="milestone-checkbox" checked>
                        <div class="milestone-text">獨自站立</div>
                        <div class="milestone-age">9-12個月</div>
                    </div>
                    <div class="milestone-item">
                        <input type="checkbox" class="milestone-checkbox" checked>
                        <div class="milestone-text">爬行</div>
                        <div class="milestone-age">6-10個月</div>
                    </div>
                    <div class="milestone-item">
                        <input type="checkbox" class="milestone-checkbox">
                        <div class="milestone-text">獨自行走</div>
                        <div class="milestone-age">12-18個月</div>
                    </div>
                </div>
            </div>
            <div class="milestone-category">
                <div class="milestone-category-title">語言發展</div>
                <div class="milestone-list">
                    <div class="milestone-item">
                        <input type="checkbox" class="milestone-checkbox" checked>
                        <div class="milestone-text">牙牙學語</div>
                        <div class="milestone-age">4-6個月</div>
                    </div>
                    <div class="milestone-item">
                        <input type="checkbox" class="milestone-checkbox" checked>
                        <div class="milestone-text">對自己的名字有反應</div>
                        <div class="milestone-age">5-7個月</div>
                    </div>
                    <div class="milestone-item">
                        <input type="checkbox" class="milestone-checkbox">
                        <div class="milestone-text">說第一個有意義的詞</div>
                        <div class="milestone-age">10-14個月</div>
                    </div>
                </div>
            </div>
            <div class="milestone-category">
                <div class="milestone-category-title">社交發展</div>
                <div class="milestone-list">
                    <div class="milestone-item">
                        <input type="checkbox" class="milestone-checkbox" checked>
                        <div class="milestone-text">對著鏡子中的自己微笑</div>
                        <div class="milestone-age">6-9個月</div>
                    </div>
                    <div class="milestone-item">
                        <input type="checkbox" class="milestone-checkbox">
                        <div class="milestone-text">玩躲貓貓遊戲</div>
                        <div class="milestone-age">9-12個月</div>
                    </div>
                    <div class="milestone-item">
                        <input type="checkbox" class="milestone-checkbox">
                        <div class="milestone-text">模仿大人的行為</div>
                        <div class="milestone-age">12-18個月</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">日常活動紀錄</div>
                <button class="btn btn-sm btn-primary" id="addActivityBtn">
                    <i class="fas fa-plus"></i> 新增
                </button>
            </div>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">親子共讀</div>
                        <div class="timeline-text">小豬故事書</div>
                        <div class="timeline-time">今天 09:30</div>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">遊戲時間</div>
                        <div class="timeline-text">積木遊戲</div>
                        <div class="timeline-time">昨天 16:00</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Health Page -->
    <div id="healthPage" class="page container hidden">
        <div class="card">
            <div class="card-header">
                <div class="card-title">健康紀錄</div>
                <button class="btn btn-sm btn-primary" id="addHealthRecordBtn">
                    <i class="fas fa-plus"></i> 新增
                </button>
            </div>
            <div class="health-stat">
                <div class="health-stat-label">體重</div>
                <div class="health-stat-value">9.2 公斤</div>
            </div>
            <div class="health-stat">
                <div class="health-stat-label">身高</div>
                <div class="health-stat-value">75.5 公分</div>
            </div>
            <div class="health-stat">
                <div class="health-stat-label">頭圍</div>
                <div class="health-stat-value">45.3 公分</div>
            </div>
            <div class="health-chart-container">
                <img src="/api/placeholder/400/200" alt="生長曲線圖表">
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">疫苗接種紀錄</div>
            </div>
            <div class="vaccine-list">
                <div class="vaccine-item">
                    <div class="vaccine-status completed"></div>
                    <div class="vaccine-details">
                        <div class="vaccine-name">B型肝炎疫苗 (第1劑)</div>
                        <div class="vaccine-schedule">出生時</div>
                    </div>
                    <div class="vaccine-date">2023/12/15</div>
                </div>
                <div class="vaccine-item">
                    <div class="vaccine-status completed"></div>
                    <div class="vaccine-details">
                        <div class="vaccine-name">五合一疫苗 (第1劑)</div>
                        <div class="vaccine-schedule">2個月</div>
                    </div>
                    <div class="vaccine-date">2024/02/20</div>
                </div>
                <div class="vaccine-item">
                    <div class="vaccine-status completed"></div>
                    <div class="vaccine-details">
                        <div class="vaccine-name">肺炎鏈球菌結合型疫苗 (第1劑)</div>
                        <div class="vaccine-schedule">2個月</div>
                    </div>
                    <div class="vaccine-date">2024/02/20</div>
                </div>
                <div class="vaccine-item">
                    <div class="vaccine-status upcoming"></div>
                    <div class="vaccine-details">
                        <div class="vaccine-name">五合一疫苗 (第2劑)</div>
                        <div class="vaccine-schedule">4個月</div>
                    </div>
                    <div class="vaccine-date">預定 2024/04/20</div>
                </div>
                <div class="vaccine-item">
                    <div class="vaccine-status upcoming"></div>
                    <div class="vaccine-details">
                        <div class="vaccine-name">口服輪狀病毒疫苗 (第2劑)</div>
                        <div class="vaccine-schedule">4個月</div>
                    </div>
                    <div class="vaccine-date">預定 2024/04/20</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">藥物紀錄</div>
                <button class="btn btn-sm btn-primary" id="addMedicationBtn">
                    <i class="fas fa-plus"></i> 新增
                </button>
            </div>
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-icon health">
                        <i class="fas fa-pills"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">退燒藥</div>
                        <div class="timeline-text">小兒普拿疼 5ml</div>
                        <div class="timeline-time">昨天 14:30</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settingsPage" class="page container hidden">
        <div class="card">
            <div class="card-header">
                <div class="card-title">主題設定</div>
            </div>
            <div class="theme-switch">
                <div class="setting-label">深色模式</div>
                <label class="switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">資料管理</div>
            </div>
            <div class="setting-item">
                <div class="setting-label">備份資料</div>
                <button class="btn btn-sm btn-outline setting-action" id="backupDataBtn">
                    <i class="fas fa-download"></i> 備份
                </button>
            </div>
            <div class="setting-item">
                <div class="setting-label">還原資料</div>
                <button class="btn btn-sm btn-outline setting-action" id="restoreDataBtn">
                    <i class="fas fa-upload"></i> 還原
                </button>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">孩子資料</div>
                <button class="btn btn-sm btn-primary" id="addChildBtn">
                    <i class="fas fa-plus"></i> 新增
                </button>
            </div>
            <div class="child-profile-list">
                <div class="setting-item">
                    <div class="child-avatar" style="width: 2rem; height: 2rem;">
                        <img src="/api/placeholder/80/80" alt="孩子頭像">
                    </div>
                    <div class="setting-label">小明</div>
                    <button class="btn btn-sm btn-outline setting-action" data-child-id="1">
                        <i class="fas fa-edit"></i> 編輯
                    </button>
                </div>
                <div class="setting-item">
                    <div class="child-avatar" style="width: 2rem; height: 2rem;">
                        <img src="/api/placeholder/80/80" alt="孩子頭像">
                    </div>
                    <div class="setting-label">小華</div>
                    <button class="btn btn-sm btn-outline setting-action" data-child-id="2">
                        <i class="fas fa-edit"></i> 編輯
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title">關於</div>
            </div>
            <div class="setting-item">
                <div class="setting-label">版本</div>
                <div class="text-gray">1.0.0</div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab">
        <div class="quick-actions" id="quickActions">
            <div class="quick-action">
                <button class="btn btn-circle btn-primary" id="quickFeedingBtn">
                    <i class="fas fa-utensils"></i>
                </button>
                <span class="quick-action-label">餵食</span>
            </div>
            <div class="quick-action">
                <button class="btn btn-circle btn-primary" id="quickSleepBtn">
                    <i class="fas fa-moon"></i>
                </button>
                <span class="quick-action-label">睡眠</span>
            </div>
            <div class="quick-action">
                <button class="btn btn-circle btn-primary" id="quickDiaperBtn">
                    <i class="fas fa-baby"></i>
                </button>
                <span class="quick-action-label">尿布</span>
            </div>
        </div>
        <button class="btn btn-circle btn-primary" id="fabBtn">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Tab Navigation -->
    <nav class="tab-navigation">
        <a href="#dashboard" class="active" data-page="dashboardPage">
            <i class="fas fa-home"></i>
            <span>首頁</span>
        </a>
        <a href="#care" data-page="carePage">
            <i class="fas fa-heart"></i>
            <span>照護</span>
        </a>
        <a href="#development" data-page="developmentPage">
            <i class="fas fa-child"></i>
            <span>發展</span>
        </a>
        <a href="#health" data-page="healthPage">
            <i class="fas fa-medkit"></i>
            <span>健康</span>
        </a>
        <a href="#settings" data-page="settingsPage">
            <i class="fas fa-cog"></i>
            <span>設定</span>
        </a>
    </nav>

    <!-- Modals -->
    <!-- Feeding Modal -->
    <div class="modal" id="feedingModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">新增餵食紀錄</div>
                <button class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="feeding-type-selector">
                    <div class="feeding-type active" data-type="breast">
                        <i class="fas fa-tint"></i> 母乳
                    </div>
                    <div class="feeding-type" data-type="formula">
                        <i class="fas fa-baby-carriage"></i> 配方奶
                    </div>
                    <div class="feeding-type" data-type="solids">
                        <i class="fas fa-utensils"></i> 副食品
                    </div>
                </div>

                <div class="feeding-options-container">
                    <div class="feeding-options active" id="breastOptions">
                        <div class="form-group">
                            <label class="form-label">哺乳方式</label>
                            <div class="btn-group-toggle">
                                <input type="radio" name="breastSide" id="leftSide" checked>
                                <label for="leftSide">左側</label>
                                <input type="radio" name="breastSide" id="rightSide">
                                <label for="rightSide">右側</label>
                                <input type="radio" name="breastSide" id="bothSides">
                                <label for="bothSides">雙側</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">餵食時間</label>
                            <div class="timer">
                                <div class="timer-display">00:00</div>
                                <div class="timer-controls">
                                    <button class="btn btn-primary" id="startBreastTimer">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button class="btn btn-outline" id="stopBreastTimer" disabled>
                                        <i class="fas fa-stop"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="feeding-options" id="formulaOptions">
                        <div class="form-group">
                            <label class="form-label">奶粉品牌</label>
                            <input type="text" class="form-control" placeholder="輸入奶粉品牌">
                        </div>
                        <div class="form-group">
                            <label class="form-label">量 (ml)</label>
                            <input type="number" class="form-control" value="120">
                        </div>
                    </div>

                    <div class="feeding-options" id="solidsOptions">
                        <div class="form-group">
                            <label class="form-label">食物類型</label>
                            <select class="form-select">
                                <option>米糊</option>
                                <option>蔬菜泥</option>
                                <option>水果泥</option>
                                <option>麵條</option>
                                <option>肉泥</option>
                                <option>其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">備註</label>
                            <textarea class="form-control" rows="3" placeholder="輸入備註"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">日期時間</label>
                    <input type="datetime-local" class="form-control" id="feedingDateTime">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" data-dismiss="modal">取消</button>
                <button class="btn btn-primary" id="saveFeedingBtn">儲存</button>
            </div>
        </div>
    </div>

    <!-- Sleep Modal -->
    <div class="modal" id="sleepModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">新增睡眠紀錄</div>
                <button class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">開始時間</label>
                    <input type="datetime-local" class="form-control" id="sleepStartTime">
                </div>
                <div class="form-group">
                    <label class="form-label">結束時間</label>
                    <input type="datetime-local" class="form-control" id="sleepEndTime">
                </div>
                <div class="form-group">
                    <label class="form-label">睡眠品質</label>
                    <div class="sleep-quality-selector">
                        <div class="sleep-quality-option" data-quality="good">
                            <div class="sleep-quality-icon">
                                <i class="fas fa-smile"></i>
                            </div>
                            <div class="sleep-quality-label">良好</div>
                        </div>
                        <div class="sleep-quality-option active" data-quality="normal">
                            <div class="sleep-quality-icon">
                                <i class="fas fa-meh"></i>
                            </div>
                            <div class="sleep-quality-label">普通</div>
                        </div>
                        <div class="sleep-quality-option" data-quality="bad">
                            <div class="sleep-quality-icon">
                                <i class="fas fa-frown"></i>
                            </div>
                            <div class="sleep-quality-label">不佳</div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">備註</label>
                    <textarea class="form-control" rows="3" placeholder="輸入備註"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" data-dismiss="modal">取消</button>
                <button class="btn btn-primary" id="saveSleepBtn">儲存</button>
            </div>
        </div>
    </div>

    <!-- Diaper Modal -->
    <div class="modal" id="diaperModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">新增尿布紀錄</div>
                <button class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">尿布類型</label>
                    <div class="diaper-type-selector">
                        <div class="feeding-type active" data-type="wet">
                            <i class="fas fa-tint"></i> 濕尿布
                        </div>
                        <div class="feeding-type" data-type="dirty">
                            <i class="fas fa-poo"></i> 大便
                        </div>
                    </div>
                </div>
                <div class="form-group" id="diaperCharacteristicsContainer">
                    <label class="form-label">大便特徵</label>
                    <div class="diaper-characteristics">
                        <div class="characteristic-chip" data-char="yellow">黃色</div>
                        <div class="characteristic-chip" data-char="green">綠色</div>
                        <div class="characteristic-chip" data-char="brown">棕色</div>
                        <div class="characteristic-chip" data-char="soft">軟便</div>
                        <div class="characteristic-chip" data-char="hard">硬便</div>
                        <div class="characteristic-chip" data-char="mucus">有黏液</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">日期時間</label>
                    <input type="datetime-local" class="form-control" id="diaperDateTime">
                </div>
                <div class="form-group">
                    <label class="form-label">備註</label>
                    <textarea class="form-control" rows="3" placeholder="輸入備註"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" data-dismiss="modal">取消</button>
                <button class="btn btn-primary" id="saveDiaperBtn">儲存</button>
            </div>
        </div>
    </div>

    <!-- Activity Modal -->
    <div class="modal" id="activityModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">新增活動紀錄</div>
                <button class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">活動類型</label>
                    <div class="activity-type-selector">
                        <div class="activity-type active" data-activity="reading">親子共讀</div>
                        <div class="activity-type" data-activity="play">遊戲時間</div>
                        <div class="activity-type" data-activity="bath">洗澡</div>
                        <div class="activity-type" data-activity="outdoor">戶外活動</div>
                        <div class="activity-type" data-activity="social">社交活動</div>
                        <div class="activity-type" data-activity="other">其他</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">活動名稱</label>
                    <input type="text" class="form-control" id="activityTitle" value="親子共讀">
                </div>
                <div class="form-group">
                    <label class="form-label">心情標籤</label>
                    <div class="emotion-tags">
                        <div class="emotion-tag happy">
                            <i class="fas fa-smile"></i> 開心
                        </div>
                        <div class="emotion-tag calm">
                            <i class="fas fa-meh"></i> 平靜
                        </div>
                        <div class="emotion-tag tired">
                            <i class="fas fa-tired"></i> 疲倦
                        </div>
                        <div class="emotion-tag fussy">
                            <i class="fas fa-angry"></i> 煩躁
                        </div>
                        <div class="emotion-tag curious">
                            <i class="fas fa-surprise"></i> 好奇
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">照片 (選填)</label>
                    <input type="file" class="form-control" accept="image/*" multiple>
                    <div class="photo-preview">
                        <div class="preview-item">
                            <img src="/api/placeholder/100/100" alt="照片預覽">
                            <div class="preview-delete">
                                <i class="fas fa-times"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">日期時間</label>
                    <input type="datetime-local" class="form-control" id="activityDateTime">
                </div>
                <div class="form-group">
                    <label class="form-label">備註</label>
                    <textarea class="form-control" rows="3" placeholder="輸入備註"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" data-dismiss="modal">取消</button>
                <button class="btn btn-primary" id="saveActivityBtn">儲存</button>
            </div>
        </div>
    </div>

    <!-- Health Record Modal -->
    <div class="modal" id="healthRecordModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">新增健康紀錄</div>
                <button class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">記錄類型</label>
                    <select class="form-select" id="healthRecordType">
                        <option value="weight">體重</option>
                        <option value="height">身高</option>
                        <option value="headCircumference">頭圍</option>
                        <option value="temperature">體溫</option>
                        <option value="vaccine">疫苗</option>
                        <option value="medication">藥物</option>
                        <option value="doctor">門診記錄</option>
                    </select>
                </div>
                <div class="health-record-form" id="weightForm">
                    <div class="form-group">
                        <label class="form-label">體重 (公斤)</label>
                        <input type="number" step="0.1" class="form-control" value="9.2">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">日期時間</label>
                    <input type="datetime-local" class="form-control" id="healthDateTime">
                </div>
                <div class="form-group">
                    <label class="form-label">備註</label>
                    <textarea class="form-control" rows="3" placeholder="輸入備註"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" data-dismiss="modal">取消</button>
                <button class="btn btn-primary" id="saveHealthBtn">儲存</button>
            </div>
        </div>
    </div>

    <!-- Child Profile Modal -->
    <div class="modal" id="childProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">孩子資料</div>
                <button class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="avatar-upload">
                    <div class="avatar-preview">
                        <img src="/api/placeholder/150/150" alt="孩子頭像預覽">
                    </div>
                    <div class="text-center">
                        <input type="file" id="avatarUpload" accept="image/*" class="visually-hidden">
                        <label for="avatarUpload" class="btn btn-sm btn-outline">
                            <i class="fas fa-camera"></i> 上傳頭像
                        </label>
                    </div>
                </div>
                <div class="profile-form">
                    <div class="form-group">
                        <label class="form-label">姓名</label>
                        <input type="text" class="form-control" placeholder="輸入姓名">
                    </div>
                    <div class="form-group">
                        <label class="form-label">性別</label>
                        <div class="btn-group-toggle">
                            <input type="radio" name="gender" id="male" checked>
                            <label for="male">男</label>
                            <input type="radio" name="gender" id="female">
                            <label for="female">女</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">出生日期</label>
                        <input type="date" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">出生體重 (公克)</label>
                        <input type="number" class="form-control" placeholder="輸入出生體重">
                    </div>
                    <div class="form-group">
                        <label class="form-label">出生身高 (公分)</label>
                        <input type="number" class="form-control" placeholder="輸入出生身高">
                    </div>
                    <div class="form-group">
                        <label class="form-label">備註</label>
                        <textarea class="form-control" rows="3" placeholder="輸入備註"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" data-dismiss="modal">取消</button>
                <button class="btn btn-primary" id="saveChildBtn">儲存</button>
            </div>
        </div>
    </div>

    <!-- Child Switch Modal -->
    <div class="modal" id="childSwitchModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">切換孩子</div>
                <button class="modal-close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="child-switch-list">
                    <div class="setting-item" data-child-id="1">
                        <div class="child-avatar" style="width: 2.5rem; height: 2.5rem;">
                            <img src="/api/placeholder/80/80" alt="孩子頭像">
                        </div>
                        <div class="setting-label">小明</div>
                        <div class="text-small text-gray">1歲3個月</div>
                    </div>
                    <div class="setting-item" data-child-id="2">
                        <div class="child-avatar" style="width: 2.5rem; height: 2.5rem;">
                            <img src="/api/placeholder/80/80" alt="孩子頭像">
                        </div>
                        <div class="setting-label">小華</div>
                        <div class="text-small text-gray">3個月</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Link to FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date time values
            const now = new Date();
            const formattedDate = now.toISOString().slice(0, 16);
            
            document.querySelectorAll('input[type="datetime-local"]').forEach(input => {
                input.value = formattedDate;
            });

            // Tab Navigation
            const navLinks = document.querySelectorAll('.tab-navigation a');
            const pages = document.querySelectorAll('.page');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active link
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show selected page
                    const targetPage = this.getAttribute('data-page');
                    pages.forEach(page => page.classList.add('hidden'));
                    document.getElementById(targetPage).classList.remove('hidden');
                });
            });

            // Floating Action Button
            const fabBtn = document.getElementById('fabBtn');
            const quickActions = document.getElementById('quickActions');

            fabBtn.addEventListener('click', function() {
                quickActions.classList.toggle('active');
                if (quickActions.classList.contains('active')) {
                    fabBtn.innerHTML = '<i class="fas fa-times"></i>';
                } else {
                    fabBtn.innerHTML = '<i class="fas fa-plus"></i>';
                }
            });

            // Quick Action Buttons
            document.getElementById('quickFeedingBtn').addEventListener('click', function() {
                showModal('feedingModal');
                quickActions.classList.remove('active');
                fabBtn.innerHTML = '<i class="fas fa-plus"></i>';
            });

            document.getElementById('quickSleepBtn').addEventListener('click', function() {
                showModal('sleepModal');
                quickActions.classList.remove('active');
                fabBtn.innerHTML = '<i class="fas fa-plus"></i>';
            });

            document.getElementById('quickDiaperBtn').addEventListener('click', function() {
                showModal('diaperModal');
                quickActions.classList.remove('active');
                fabBtn.innerHTML = '<i class="fas fa-plus"></i>';
            });

            // Add Buttons
            document.getElementById('addFeedingBtn').addEventListener('click', function() {
                showModal('feedingModal');
            });

            document.getElementById('addSleepBtn').addEventListener('click', function() {
                showModal('sleepModal');
            });

            document.getElementById('addDiaperBtn').addEventListener('click', function() {
                showModal('diaperModal');
            });

            document.getElementById('addActivityBtn').addEventListener('click', function() {
                showModal('activityModal');
            });

            document.getElementById('addHealthRecordBtn').addEventListener('click', function() {
                showModal('healthRecordModal');
            });

            document.getElementById('addMedicationBtn').addEventListener('click', function() {
                const healthRecordModal = document.getElementById('healthRecordModal');
                const healthRecordType = document.getElementById('healthRecordType');
                healthRecordType.value = 'medication';
                showModal('healthRecordModal');
            });

            document.getElementById('childSwitchBtn').addEventListener('click', function() {
                showModal('childSwitchModal');
            });

            document.getElementById('addChildBtn').addEventListener('click', function() {
                showModal('childProfileModal');
            });

            // Close modals
            document.querySelectorAll('[data-dismiss="modal"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    hideModal(modal.id);
                });
            });

            // Save buttons (for demonstration)
            document.querySelectorAll('[id$="Btn"]').forEach(btn => {
                if (btn.id.startsWith('save')) {
                    btn.addEventListener('click', function() {
                        const modal = this.closest('.modal');
                        hideModal(modal.id);
                        // In a real app, we would save the data here
                    });
                }
            });

            // Theme Toggle
            const themeToggle = document.getElementById('themeToggle');
            themeToggle.addEventListener('change', function() {
                if (this.checked) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                    localStorage.setItem('theme', 'light');
                }
            });

            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                themeToggle.checked = true;
                document.documentElement.setAttribute('data-theme', 'dark');
            }

            // Feeding type selector
            const feedingTypes = document.querySelectorAll('.feeding-type-selector .feeding-type');
            const feedingOptions = document.querySelectorAll('.feeding-options');

            feedingTypes.forEach(type => {
                type.addEventListener('click', function() {
                    // Update active feeding type
                    feedingTypes.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding options
                    const feedingType = this.getAttribute('data-type');
                    feedingOptions.forEach(option => option.classList.remove('active'));
                    document.getElementById(`${feedingType}Options`).classList.add('active');
                });
            });

            // Diaper type selector
            const diaperTypes = document.querySelectorAll('.diaper-type-selector .feeding-type');
            const diaperCharacteristicsContainer = document.getElementById('diaperCharacteristicsContainer');

            diaperTypes.forEach(type => {
                type.addEventListener('click', function() {
                    // Update active diaper type
                    diaperTypes.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show/hide characteristics based on type
                    const diaperType = this.getAttribute('data-type');
                    if (diaperType === 'dirty') {
                        diaperCharacteristicsContainer.classList.remove('hidden');
                    } else {
                        diaperCharacteristicsContainer.classList.add('hidden');
                    }
                });
            });

            // Characteristic chips
            const characteristicChips = document.querySelectorAll('.characteristic-chip');
            characteristicChips.forEach(chip => {
                chip.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            });

            // Sleep quality selector
            const sleepQualityOptions = document.querySelectorAll('.sleep-quality-option');
            sleepQualityOptions.forEach(option => {
                option.addEventListener('click', function() {
                    sleepQualityOptions.forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Activity type selector
            const activityTypes = document.querySelectorAll('.activity-type');
            const activityTitle = document.getElementById('activityTitle');

            activityTypes.forEach(type => {
                type.addEventListener('click', function() {
                    activityTypes.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update title based on selected activity
                    const activityType = this.textContent;
                    activityTitle.value = activityType;
                });
            });

            // Emotion tags
            const emotionTags = document.querySelectorAll('.emotion-tag');
            emotionTags.forEach(tag => {
                tag.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            });

            // Child switch items
            const childSwitchItems = document.querySelectorAll('.child-switch-list .setting-item');
            childSwitchItems.forEach(item => {
                item.addEventListener('click', function() {
                    const childId = this.getAttribute('data-child-id');
                    const childName = this.querySelector('.setting-label').textContent;
                    const childAge = this.querySelector('.text-gray').textContent;
                    
                    // Update active child
                    document.getElementById('activeChildName').textContent = childName;
                    document.getElementById('activeChildAge').textContent = childAge;
                    
                    hideModal('childSwitchModal');
                });
            });

            // Backup and restore data buttons
            document.getElementById('backupDataBtn').addEventListener('click', function() {
                // In a real app, we would export the data here
                alert('資料備份功能將在完整版中提供');
            });

            document.getElementById('restoreDataBtn').addEventListener('click', function() {
                // In a real app, we would import the data here
                alert('資料還原功能將在完整版中提供');
            });

            // Timer functionality
            let timerInterval;
            let seconds = 0;
            
            function updateTimerDisplay() {
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                document.querySelector('.timer-display').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            document.getElementById('startBreastTimer').addEventListener('click', function() {
                this.disabled = true;
                document.getElementById('stopBreastTimer').disabled = false;
                
                timerInterval = setInterval(() => {
                    seconds++;
                    updateTimerDisplay();
                }, 1000);
            });
            
            document.getElementById('stopBreastTimer').addEventListener('click', function() {
                this.disabled = true;
                document.getElementById('startBreastTimer').disabled = false;
                clearInterval(timerInterval);
            });

            // Initialize IndexedDB
            initializeDatabase();
        });

        // Show modal
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
        }

        // Hide modal
        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
        }

        // Initialize the IndexedDB database
        function initializeDatabase() {
            const request = indexedDB.open('BabyCareDB', 1);
            
            request.onerror = function(event) {
                console.error('IndexedDB error:', event.target.error);
            };
            
            request.onupgradeneeded = function(event) {
                const db = event.target.result;
                
                // Create children store
                const childrenStore = db.createObjectStore('children', { keyPath: 'id', autoIncrement: true });
                childrenStore.createIndex('name', 'name', { unique: false });
                childrenStore.createIndex('birthdate', 'birthdate', { unique: false });
                
                // Create feeding store
                const feedingStore = db.createObjectStore('feeding', { keyPath: 'id', autoIncrement: true });
                feedingStore.createIndex('childId', 'childId', { unique: false });
                feedingStore.createIndex('datetime', 'datetime', { unique: false });
                feedingStore.createIndex('type', 'type', { unique: false });
                
                // Create sleep store
                const sleepStore = db.createObjectStore('sleep', { keyPath: 'id', autoIncrement: true });
                sleepStore.createIndex('childId', 'childId', { unique: false });
                sleepStore.createIndex('startTime', 'startTime', { unique: false });
                sleepStore.createIndex('endTime', 'endTime', { unique: false });
                
                // Create diaper store
                const diaperStore = db.createObjectStore('diaper', { keyPath: 'id', autoIncrement: true });
                diaperStore.createIndex('childId', 'childId', { unique: false });
                diaperStore.createIndex('datetime', 'datetime', { unique: false });
                diaperStore.createIndex('type', 'type', { unique: false });
                
                // Create health store
                const healthStore = db.createObjectStore('health', { keyPath: 'id', autoIncrement: true });
                healthStore.createIndex('childId', 'childId', { unique: false });
                healthStore.createIndex('datetime', 'datetime', { unique: false });
                healthStore.createIndex('type', 'type', { unique: false });
                
                // Create activity store
                const activityStore = db.createObjectStore('activity', { keyPath: 'id', autoIncrement: true });
                activityStore.createIndex('childId', 'childId', { unique: false });
                activityStore.createIndex('datetime', 'datetime', { unique: false });
                activityStore.createIndex('type', 'type', { unique: false });
                
                // Create milestone store
                const milestoneStore = db.createObjectStore('milestone', { keyPath: 'id', autoIncrement: true });
                milestoneStore.createIndex('childId', 'childId', { unique: false });
                milestoneStore.createIndex('category', 'category', { unique: false });
                milestoneStore.createIndex('completed', 'completed', { unique: false });
                
                // Insert default data for demonstration
                addDefaultData(db);
            };
            
            request.onsuccess = function(event) {
                const db = event.target.result;
                
                // Add database to window object for global access
                window.db = db;
                
                console.log('Database initialized successfully!');
            };
        }

        // Add default data for demonstration
        function addDefaultData(db) {
            // Add default children
            const transaction = db.transaction(['children'], 'readwrite');
            const childrenStore = transaction.objectStore('children');
            
            childrenStore.add({
                name: '小明',
                gender: 'male',
                birthdate: new Date(2023, 1, 15), // February 15, 2023
                birthWeight: 3200, // grams
                birthHeight: 50 // cm
            });
            
            childrenStore.add({
                name: '小華',
                gender: 'female',
                birthdate: new Date(2024, 1, 15), // February 15, 2024
                birthWeight: 3100, // grams
                birthHeight: 49 // cm
            });
            
            transaction.oncomplete = function() {
                console.log('Default data added successfully!');
            };
            
            transaction.onerror = function(event) {
                console.error('Transaction error:', event.target.error);
            };
        }

        // Database Operations
        // These functions would be called from the UI event handlers

        // Save feeding record
        function saveFeedingRecord(childId, data) {
            const transaction = window.db.transaction(['feeding'], 'readwrite');
            const store = transaction.objectStore('feeding');
            
            const record = {
                childId: childId,
                datetime: new Date(data.datetime),
                type: data.type, // breast, formula, solids
                ...data
            };
            
            const request = store.add(record);
            
            request.onsuccess = function() {
                console.log('Feeding record saved successfully!');
                // Update UI or show success message
                updateTimeline();
            };
            
            request.onerror = function(event) {
                console.error('Error saving feeding record:', event.target.error);
                // Show error message
            };
        }

        // Save sleep record
        function saveSleepRecord(childId, data) {
            const transaction = window.db.transaction(['sleep'], 'readwrite');
            const store = transaction.objectStore('sleep');
            
            const record = {
                childId: childId,
                startTime: new Date(data.startTime),
                endTime: new Date(data.endTime),
                quality: data.quality, // good, normal, bad
                notes: data.notes
            };
            
            const request = store.add(record);
            
            request.onsuccess = function() {
                console.log('Sleep record saved successfully!');
                // Update UI or show success message
                updateTimeline();
            };
            
            request.onerror = function(event) {
                console.error('Error saving sleep record:', event.target.error);
                // Show error message
            };
        }

        // Save diaper record
        function saveDiaperRecord(childId, data) {
            const transaction = window.db.transaction(['diaper'], 'readwrite');
            const store = transaction.objectStore('diaper');
            
            const record = {
                childId: childId,
                datetime: new Date(data.datetime),
                type: data.type, // wet, dirty
                characteristics: data.characteristics || [],
                notes: data.notes
            };
            
            const request = store.add(record);
            
            request.onsuccess = function() {
                console.log('Diaper record saved successfully!');
                // Update UI or show success message
                updateTimeline();
            };
            
            request.onerror = function(event) {
                console.error('Error saving diaper record:', event.target.error);
                // Show error message
            };
        }

        // Save health record
        function saveHealthRecord(childId, data) {
            const transaction = window.db.transaction(['health'], 'readwrite');
            const store = transaction.objectStore('health');
            
            const record = {
                childId: childId,
                datetime: new Date(data.datetime),
                type: data.type, // weight, height, temperature, etc.
                value: data.value,
                unit: data.unit,
                notes: data.notes
            };
            
            const request = store.add(record);
            
            request.onsuccess = function() {
                console.log('Health record saved successfully!');
                // Update UI or show success message
                updateDashboardStats();
            };
            
            request.onerror = function(event) {
                console.error('Error saving health record:', event.target.error);
                // Show error message
            };
        }

        // Save activity record
        function saveActivityRecord(childId, data) {
            const transaction = window.db.transaction(['activity'], 'readwrite');
            const store = transaction.objectStore('activity');
            
            const record = {
                childId: childId,
                datetime: new Date(data.datetime),
                type: data.type, // reading, play, bath, etc.
                title: data.title,
                emotions: data.emotions || [],
                photos: data.photos || [],
                notes: data.notes
            };
            
            const request = store.add(record);
            
            request.onsuccess = function() {
                console.log('Activity record saved successfully!');
                // Update UI or show success message
                updateTimeline();
            };
            
            request.onerror = function(event) {
                console.error('Error saving activity record:', event.target.error);
                // Show error message
            };
        }

        // Save milestone record
        function saveMilestoneRecord(childId, data) {
            const transaction = window.db.transaction(['milestone'], 'readwrite');
            const store = transaction.objectStore('milestone');
            
            const record = {
                childId: childId,
                category: data.category, // motor, language, social, cognitive
                milestone: data.milestone,
                completed: data.completed,
                completedDate: data.completed ? new Date() : null,
                ageRange: data.ageRange
            };
            
            const request = store.add(record);
            
            request.onsuccess = function() {
                console.log('Milestone record saved successfully!');
                // Update UI or show success message
            };
            
            request.onerror = function(event) {
                console.error('Error saving milestone record:', event.target.error);
                // Show error message
            };
        }

        // Save child profile
        function saveChildProfile(data) {
            const transaction = window.db.transaction(['children'], 'readwrite');
            const store = transaction.objectStore('children');
            
            const child = {
                name: data.name,
                gender: data.gender,
                birthdate: new Date(data.birthdate),
                birthWeight: data.birthWeight,
                birthHeight: data.birthHeight,
                avatar: data.avatar,
                notes: data.notes
            };
            
            // If updating existing child
            if (data.id) {
                child.id = data.id;
                const request = store.put(child);
                
                request.onsuccess = function() {
                    console.log('Child profile updated successfully!');
                    // Update UI or show success message
                    updateChildInfo(data.id);
                };
            } else {
                // Adding new child
                const request = store.add(child);
                
                request.onsuccess = function(event) {
                    const childId = event.target.result;
                    console.log('Child profile saved successfully!');
                    // Update UI or show success message
                    updateChildInfo(childId);
                };
            }
            
            transaction.onerror = function(event) {
                console.error('Error saving child profile:', event.target.error);
                // Show error message
            };
        }

        // Get records from the past 24 hours
        function getTodayRecords(childId, storeName, callback) {
            const transaction = window.db.transaction([storeName], 'readonly');
            const store = transaction.objectStore(storeName);
            const index = store.index('childId');
            
            const now = new Date();
            const yesterday = new Date(now);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const range = IDBKeyRange.bound([childId, yesterday], [childId, now]);
            const request = index.openCursor(range);
            
            const records = [];
            
            request.onsuccess = function(event) {
                const cursor = event.target.result;
                if (cursor) {
                    records.push(cursor.value);
                    cursor.continue();
                } else {
                    callback(records);
                }
            };
            
            request.onerror = function(event) {
                console.error(`Error retrieving ${storeName} records:`, event.target.error);
                callback([]);
            };
        }

        // Get the last health measurements
        function getLastHealthMeasurements(childId, callback) {
            const transaction = window.db.transaction(['health'], 'readonly');
            const store = transaction.objectStore('health');
            const index = store.index('childId');
            
            const range = IDBKeyRange.only(childId);
            const request = index.openCursor(range, 'prev');
            
            const measurements = {
                weight: null,
                height: null,
                headCircumference: null
            };
            
            let count = 0;
            
            request.onsuccess = function(event) {
                const cursor = event.target.result;
                if (cursor && count < 20) { // Limit to check first 20 records
                    const record = cursor.value;
                    
                    if (record.type === 'weight' && !measurements.weight) {
                        measurements.weight = record;
                    } else if (record.type === 'height' && !measurements.height) {
                        measurements.height = record;
                    } else if (record.type === 'headCircumference' && !measurements.headCircumference) {
                        measurements.headCircumference = record;
                    }
                    
                    // If we have all measurements, stop searching
                    if (measurements.weight && measurements.height && measurements.headCircumference) {
                        callback(measurements);
                        return;
                    }
                    
                    count++;
                    cursor.continue();
                } else {
                    callback(measurements);
                }
            };
            
            request.onerror = function(event) {
                console.error('Error retrieving health measurements:', event.target.error);
                callback(measurements);
            };
        }

        // Get child info by ID
        function getChildInfo(childId, callback) {
            const transaction = window.db.transaction(['children'], 'readonly');
            const store = transaction.objectStore('children');
            
            const request = store.get(childId);
            
            request.onsuccess = function(event) {
                const child = event.target.result;
                if (child) {
                    callback(child);
                } else {
                    console.error('Child not found with ID:', childId);
                    callback(null);
                }
            };
            
            request.onerror = function(event) {
                console.error('Error retrieving child info:', event.target.error);
                callback(null);
            };
        }

        // Get all children
        function getAllChildren(callback) {
            const transaction = window.db.transaction(['children'], 'readonly');
            const store = transaction.objectStore('children');
            
            const request = store.getAll();
            
            request.onsuccess = function(event) {
                const children = event.target.result;
                callback(children);
            };
            
            request.onerror = function(event) {
                console.error('Error retrieving all children:', event.target.error);
                callback([]);
            };
        }

        // Update timeline with recent records
        function updateTimeline() {
            const activeChildId = getActiveChildId();
            
            function renderTimelineItems(careRecords) {
                const timelineContainer = document.querySelector('#dashboardPage .timeline');
                timelineContainer.innerHTML = '';
                
                if (careRecords.length === 0) {
                    timelineContainer.innerHTML = '<div class="text-center text-gray mt-3">今天還沒有紀錄</div>';
                    return;
                }
                
                careRecords.forEach(record => {
                    const item = document.createElement('div');
                    item.className = 'timeline-item';
                    
                    const icon = document.createElement('div');
                    let iconClass = '';
                    let iconHtml = '';
                    
                    switch (record.type) {
                        case 'feeding':
                            iconClass = 'feeding';
                            iconHtml = '<i class="fas fa-utensils"></i>';
                            break;
                        case 'sleep':
                            iconClass = 'sleep';
                            iconHtml = '<i class="fas fa-moon"></i>';
                            break;
                        case 'diaper':
                            iconClass = 'diaper';
                            iconHtml = '<i class="fas fa-baby"></i>';
                            break;
                        case 'health':
                            iconClass = 'health';
                            iconHtml = '<i class="fas fa-medkit"></i>';
                            break;
                        case 'activity':
                            iconClass = '';
                            iconHtml = '<i class="fas fa-star"></i>';
                            break;
                        case 'milestone':
                            iconClass = 'milestone';
                            iconHtml = '<i class="fas fa-flag"></i>';
                            break;
                    }
                    
                    icon.className = `timeline-icon ${iconClass}`;
                    icon.innerHTML = iconHtml;
                    
                    const content = document.createElement('div');
                    content.className = 'timeline-content';
                    
                    let title = '';
                    let text = '';
                    let time = '';
                    
                    // Format based on record type
                    switch (record.type) {
                        case 'feeding':
                            title = '餵食';
                            if (record.feedingType === 'breast') {
                                const side = record.breastSide === 'left' ? '左側' : 
                                           record.breastSide === 'right' ? '右側' : '雙側';
                                text = `母乳 (${side})`;
                            } else if (record.feedingType === 'formula') {
                                text = `配方奶 ${record.amount}ml`;
                            } else if (record.feedingType === 'solids') {
                                text = `副食品 ${record.foodType}`;
                            }
                            time = formatDateTime(record.datetime);
                            break;
                        case 'sleep':
                            title = '睡眠';
                            const duration = calculateDuration(record.startTime, record.endTime);
                            const quality = record.quality === 'good' ? '良好' : 
                                           record.quality === 'bad' ? '不佳' : '普通';
                            text = `${duration} - ${quality}`;
                            time = formatTimeRange(record.startTime, record.endTime);
                            break;
                        case 'diaper':
                            title = '尿布更換';
                            if (record.diaperType === 'wet') {
                                text = '濕尿布';
                            } else {
                                const chars = record.characteristics && record.characteristics.length ? 
                                    record.characteristics.join(', ') : '';
                                text = `大便${chars ? ' - ' + chars : ''}`;
                            }
                            time = formatDateTime(record.datetime);
                            break;
                        case 'health':
                            title = '健康紀錄';
                            if (record.healthType === 'weight') {
                                text = `體重 ${record.value} 公斤`;
                            } else if (record.healthType === 'height') {
                                text = `身高 ${record.value} 公分`;
                            } else if (record.healthType === 'temperature') {
                                text = `體溫 ${record.value}°C`;
                            } else if (record.healthType === 'headCircumference') {
                                text = `頭圍 ${record.value} 公分`;
                            } else if (record.healthType === 'medication') {
                                text = `藥物 ${record.medicationName}`;
                            }
                            time = formatDateTime(record.datetime);
                            break;
                        case 'activity':
                            title = record.title || '活動';
                            text = record.notes || '';
                            time = formatDateTime(record.datetime);
                            break;
                        case 'milestone':
                            title = '里程碑';
                            text = record.milestone;
                            time = formatDate(record.completedDate);
                            break;
                    }
                    
                    content.innerHTML = `
                        <div class="timeline-title">${title}</div>
                        <div class="timeline-text">${text}</div>
                        <div class="timeline-time">${time}</div>
                    `;
                    
                    item.appendChild(icon);
                    item.appendChild(content);
                    timelineContainer.appendChild(item);
                });
            }
            
            // Combine records from different stores
            Promise.all([
                new Promise(resolve => getTodayRecords(activeChildId, 'feeding', resolve)),
                new Promise(resolve => getTodayRecords(activeChildId, 'sleep', resolve)),
                new Promise(resolve => getTodayRecords(activeChildId, 'diaper', resolve)),
                new Promise(resolve => getTodayRecords(activeChildId, 'health', resolve)),
                new Promise(resolve => getTodayRecords(activeChildId, 'activity', resolve))
            ]).then(([feedingRecords, sleepRecords, diaperRecords, healthRecords, activityRecords]) => {
                // Transform records to a common format
                const allRecords = [
                    ...feedingRecords.map(r => ({ ...r, type: 'feeding' })),
                    ...sleepRecords.map(r => ({ ...r, type: 'sleep' })),
                    ...diaperRecords.map(r => ({ ...r, type: 'diaper' })),
                    ...healthRecords.map(r => ({ ...r, type: 'health' })),
                    ...activityRecords.map(r => ({ ...r, type: 'activity' }))
                ];
                
                // Sort by datetime/startTime descending
                allRecords.sort((a, b) => {
                    const dateA = a.datetime || a.startTime;
                    const dateB = b.datetime || b.startTime;
                    return new Date(dateB) - new Date(dateA);
                });
                
                // Render the combined timeline
                renderTimelineItems(allRecords);
            });
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const activeChildId = getActiveChildId();
            
            // Get feeding count for today
            getTodayRecords(activeChildId, 'feeding', feedingRecords => {
                const feedingCount = feedingRecords.length;
                document.querySelector('.stat-card:nth-child(1) .stat-card-value').textContent = `${feedingCount} 次`;
            });
            
            // Get sleep duration for today
            getTodayRecords(activeChildId, 'sleep', sleepRecords => {
                let totalMinutes = 0;
                
                sleepRecords.forEach(record => {
                    const startTime = new Date(record.startTime);
                    const endTime = new Date(record.endTime);
                    const durationMinutes = (endTime - startTime) / (1000 * 60);
                    totalMinutes += durationMinutes;
                });
                
                const hours = Math.floor(totalMinutes / 60);
                const minutes = Math.round(totalMinutes % 60);
                
                const formattedDuration = minutes > 0 ? 
                    `${hours}.${Math.floor(minutes / 6)}` : `${hours}`;
                
                document.querySelector('.stat-card:nth-child(2) .stat-card-value').textContent = `${formattedDuration} 小時`;
            });
            
            // Get diaper count for today
            getTodayRecords(activeChildId, 'diaper', diaperRecords => {
                const diaperCount = diaperRecords.length;
                document.querySelector('.stat-card:nth-child(3) .stat-card-value').textContent = `${diaperCount} 次`;
            });
            
            // Get last weight measurement
            getLastHealthMeasurements(activeChildId, measurements => {
                if (measurements.weight) {
                    document.querySelector('.stat-card:nth-child(4) .stat-card-value').textContent = 
                        `${measurements.weight.value} 公斤`;
                }
                
                // Update health page stats as well
                if (measurements.weight) {
                    document.querySelector('#healthPage .health-stat:nth-child(1) .health-stat-value').textContent = 
                        `${measurements.weight.value} 公斤`;
                }
                
                if (measurements.height) {
                    document.querySelector('#healthPage .health-stat:nth-child(2) .health-stat-value').textContent = 
                        `${measurements.height.value} 公分`;
                }
                
                if (measurements.headCircumference) {
                    document.querySelector('#healthPage .health-stat:nth-child(3) .health-stat-value').textContent = 
                        `${measurements.headCircumference.value} 公分`;
                }
            });
        }

        // Update child info in UI
        function updateChildInfo(childId) {
            getChildInfo(childId, child => {
                if (!child) return;
                
                // Update header
                document.getElementById('activeChildName').textContent = child.name;
                
                // Calculate age
                const now = new Date();
                const birthdate = new Date(child.birthdate);
                const years = now.getFullYear() - birthdate.getFullYear();
                const months = now.getMonth() - birthdate.getMonth();
                const adjustedMonths = months < 0 ? months + 12 : months;
                const adjustedYears = months < 0 ? years - 1 : years;
                
                let ageText = '';
                if (adjustedYears > 0) {
                    ageText = `${adjustedYears}歲${adjustedMonths}個月`;
                } else {
                    ageText = `${adjustedMonths}個月`;
                }
                
                document.getElementById('activeChildAge').textContent = ageText;
                
                // Update avatar if available
                if (child.avatar) {
                    const avatarImg = document.querySelector('.child-avatar.active img');
                    if (avatarImg) {
                        avatarImg.src = child.avatar;
                    }
                }
                
                // Update dashboard and other stats
                updateDashboardStats();
                updateTimeline();
            });
        }

        // Get active child ID
        function getActiveChildId() {
            // In a real app, this would be stored in state or localStorage
            // For demo, we're using the default first child
            return 1;
        }

        // Format date time for display
        function formatDateTime(date) {
            date = new Date(date);
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const isToday = date >= today;
            const isYesterday = date >= yesterday && date < today;
            
            let prefix = '';
            if (isToday) {
                prefix = '';
            } else if (isYesterday) {
                prefix = '昨天 ';
            } else {
                prefix = `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')} `;
            }
            
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            
            return `${prefix}${hours}:${minutes}`;
        }

        // Format date for display
        function formatDate(date) {
            date = new Date(date);
            return `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}`;
        }

        // Format time range for display
        function formatTimeRange(start, end) {
            start = new Date(start);
            end = new Date(end);
            
            const startTime = `${start.getHours().toString().padStart(2, '0')}:${start.getMinutes().toString().padStart(2, '0')}`;
            const endTime = `${end.getHours().toString().padStart(2, '0')}:${end.getMinutes().toString().padStart(2, '0')}`;
            
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const startIsToday = start >= today;
            const startIsYesterday = start >= yesterday && start < today;
            const endIsToday = end >= today;
            
            let prefix = '';
            if (startIsToday && endIsToday) {
                prefix = '';
            } else if (startIsYesterday && endIsToday) {
                prefix = '昨天 ';
            } else {
                prefix = `${start.getFullYear()}/${(start.getMonth() + 1).toString().padStart(2, '0')}/${start.getDate().toString().padStart(2, '0')} `;
            }
            
            return `${prefix}${startTime} - ${endIsToday ? '' : '今天 '}${endTime}`;
        }

        // Calculate duration between two dates (for sleep records)
        function calculateDuration(start, end) {
            start = new Date(start);
            end = new Date(end);
            
            const durationMinutes = (end - start) / (1000 * 60);
            const hours = Math.floor(durationMinutes / 60);
            const minutes = Math.round(durationMinutes % 60);
            
            if (minutes === 0) {
                return `${hours} 小時`;
            } else {
                return `${hours} 小時 ${minutes} 分鐘`;
            }
        }

        // Export data as JSON
        function exportData(callback) {
            const exportData = {
                children: [],
                feeding: [],
                sleep: [],
                diaper: [],
                health: [],
                activity: [],
                milestone: []
            };
            
            let completed = 0;
            const stores = Object.keys(exportData);
            
            stores.forEach(storeName => {
                const transaction = window.db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                
                const request = store.getAll();
                
                request.onsuccess = function(event) {
                    exportData[storeName] = event.target.result;
                    completed++;
                    
                    if (completed === stores.length) {
                        const json = JSON.stringify(exportData, null, 2);
                        callback(json);
                    }
                };
                
                request.onerror = function(event) {
                    console.error(`Error exporting ${storeName}:`, event.target.error);
                    completed++;
                    
                    if (completed === stores.length) {
                        const json = JSON.stringify(exportData, null, 2);
                        callback(json);
                    }
                };
            });
        }

        // Import data from JSON
        function importData(jsonString, callback) {
            try {
                const data = JSON.parse(jsonString);
                
                const stores = Object.keys(data);
                let completed = 0;
                
                stores.forEach(storeName => {
                    if (!data[storeName] || !Array.isArray(data[storeName])) {
                        completed++;
                        return;
                    }
                    
                    const transaction = window.db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    
                    // Clear existing data
                    const clearRequest = store.clear();
                    
                    clearRequest.onsuccess = function() {
                        let itemsAdded = 0;
                        
                        data[storeName].forEach(item => {
                            // Convert date strings back to Date objects
                            Object.keys(item).forEach(key => {
                                if (typeof item[key] === 'string' && 
                                    (key.includes('date') || key.includes('Date') || key.includes('Time'))) {
                                    item[key] = new Date(item[key]);
                                }
                            });
                            
                            const addRequest = store.add(item);
                            
                            addRequest.onsuccess = function() {
                                itemsAdded++;
                                
                                if (itemsAdded === data[storeName].length) {
                                    completed++;
                                    
                                    if (completed === stores.length) {
                                        callback(true);
                                    }
                                }
                            };
                            
                            addRequest.onerror = function(event) {
                                console.error(`Error importing item to ${storeName}:`, event.target.error);
                                itemsAdded++;
                                
                                if (itemsAdded === data[storeName].length) {
                                    completed++;
                                    
                                    if (completed === stores.length) {
                                        callback(true);
                                    }
                                }
                            };
                        });
                        
                        // Handle empty arrays
                        if (data[storeName].length === 0) {
                            completed++;
                            
                            if (completed === stores.length) {
                                callback(true);
                            }
                        }
                    };
                    
                    clearRequest.onerror = function(event) {
                        console.error(`Error clearing ${storeName}:`, event.target.error);
                        completed++;
                        
                        if (completed === stores.length) {
                            callback(false);
                        }
                    };
                });
                
            } catch (error) {
                console.error('Error parsing JSON:', error);
                callback(false);
            }
        }

        // Attach event listeners to UI elements
        document.addEventListener('DOMContentLoaded', function() {
            // Save buttons for each modal
            document.getElementById('saveFeedingBtn').addEventListener('click', function() {
                const childId = getActiveChildId();
                const datetime = document.getElementById('feedingDateTime').value;
                
                const activeType = document.querySelector('.feeding-type-selector .feeding-type.active');
                const feedingType = activeType ? activeType.getAttribute('data-type') : 'breast';
                
                let data = {
                    datetime: datetime,
                    feedingType: feedingType
                };
                
                if (feedingType === 'breast') {
                    const breastSide = document.querySelector('input[name="breastSide"]:checked').id;
                    data.breastSide = breastSide === 'leftSide' ? 'left' : 
                                      breastSide === 'rightSide' ? 'right' : 'both';
                } else if (feedingType === 'formula') {
                    data.amount = document.querySelector('#formulaOptions input[type="number"]').value;
                    data.brand = document.querySelector('#formulaOptions input[type="text"]').value;
                } else if (feedingType === 'solids') {
                    data.foodType = document.querySelector('#solidsOptions select').value;
                    data.notes = document.querySelector('#solidsOptions textarea').value;
                }
                
                saveFeedingRecord(childId, data);
                hideModal('feedingModal');
            });
            
            document.getElementById('saveSleepBtn').addEventListener('click', function() {
                const childId = getActiveChildId();
                const startTime = document.getElementById('sleepStartTime').value;
                const endTime = document.getElementById('sleepEndTime').value;
                
                const activeQuality = document.querySelector('.sleep-quality-option.active');
                const quality = activeQuality ? activeQuality.getAttribute('data-quality') : 'normal';
                
                const notes = document.querySelector('#sleepModal textarea').value;
                
                const data = {
                    startTime: startTime,
                    endTime: endTime,
                    quality: quality,
                    notes: notes
                };
                
                saveSleepRecord(childId, data);
                hideModal('sleepModal');
            });
            
            document.getElementById('saveDiaperBtn').addEventListener('click', function() {
                const childId = getActiveChildId();
                const datetime = document.getElementById('diaperDateTime').value;
                
                const activeDiaperType = document.querySelector('.diaper-type-selector .feeding-type.active');
                const diaperType = activeDiaperType ? activeDiaperType.getAttribute('data-type') : 'wet';
                
                const characteristics = [];
                if (diaperType === 'dirty') {
                    document.querySelectorAll('.characteristic-chip.active').forEach(chip => {
                        characteristics.push(chip.getAttribute('data-char'));
                    });
                }
                
                const notes = document.querySelector('#diaperModal textarea').value;
                
                const data = {
                    datetime: datetime,
                    diaperType: diaperType,
                    characteristics: characteristics,
                    notes: notes
                };
                
                saveDiaperRecord(childId, data);
                hideModal('diaperModal');
            });
            
            document.getElementById('saveHealthBtn').addEventListener('click', function() {
                const childId = getActiveChildId();
                const datetime = document.getElementById('healthDateTime').value;
                const healthType = document.getElementById('healthRecordType').value;
                
                let value, unit;
                
                switch (healthType) {
                    case 'weight':
                        value = document.querySelector('#weightForm input').value;
                        unit = '公斤';
                        break;
                    // Other health record types would have their own forms
                    // which would be shown/hidden based on the selected type
                }
                
                const notes = document.querySelector('#healthRecordModal textarea').value;
                
                const data = {
                    datetime: datetime,
                    healthType: healthType,
                    value: value,
                    unit: unit,
                    notes: notes
                };
                
                saveHealthRecord(childId, data);
                hideModal('healthRecordModal');
            });
            
            document.getElementById('saveActivityBtn').addEventListener('click', function() {
                const childId = getActiveChildId();
                const datetime = document.getElementById('activityDateTime').value;
                
                const activeActivityType = document.querySelector('.activity-type.active');
                const activityType = activeActivityType ? activeActivityType.getAttribute('data-activity') : 'reading';
                
                const title = document.getElementById('activityTitle').value;
                
                const emotions = [];
                document.querySelectorAll('.emotion-tag.active').forEach(tag => {
                    emotions.push(tag.textContent.trim());
                });
                
                const notes = document.querySelector('#activityModal textarea').value;
                
                // Photos would be handled in a real implementation
                
                const data = {
                    datetime: datetime,
                    type: activityType,
                    title: title,
                    emotions: emotions,
                    notes: notes
                };
                
                saveActivityRecord(childId, data);
                hideModal('activityModal');
            });
            
            document.getElementById('saveChildBtn').addEventListener('click', function() {
                const name = document.querySelector('#childProfileModal input[placeholder="輸入姓名"]').value;
                const gender = document.querySelector('input[name="gender"]:checked').id === 'male' ? 'male' : 'female';
                const birthdate = document.querySelector('#childProfileModal input[type="date"]').value;
                const birthWeight = document.querySelector('#childProfileModal input[placeholder="輸入出生體重"]').value;
                const birthHeight = document.querySelector('#childProfileModal input[placeholder="輸入出生身高"]').value;
                
                // Avatar would be handled in a real implementation
                
                const notes = document.querySelector('#childProfileModal textarea').value;
                
                const data = {
                    name: name,
                    gender: gender,
                    birthdate: birthdate,
                    birthWeight: birthWeight,
                    birthHeight: birthHeight,
                    notes: notes
                };
                
                saveChildProfile(data);
                hideModal('childProfileModal');
            });
            
            // Backup data button
            document.getElementById('backupDataBtn').addEventListener('click', function() {
                exportData(jsonData => {
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `babycare_backup_${new Date().toISOString().slice(0, 10)}.json`;
                    a.click();
                    
                    URL.revokeObjectURL(url);
                });
            });
            
            // Restore data button
            document.getElementById('restoreDataBtn').addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = function(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const jsonData = e.target.result;
                        
                        importData(jsonData, success => {
                            if (success) {
                                alert('資料還原成功！');
                                // Update UI
                                updateChildInfo(getActiveChildId());
                            } else {
                                alert('資料還原失敗！');
                            }
                        });
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            });
            
            // Initialize the active child
            updateChildInfo(getActiveChildId());
        });
    </script>
</body>
</html> 